<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cloude VPN | –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</title>
    <style>
        :root {
            --primary: #00f2fe;
            --secondary: #4facfe;
            --bg-dark: #0a0e17;
            --bg-card: #151a25;
            --text-main: #ffffff;
            --text-muted: #a0a0a0;
            --accent-glow: rgba(79, 172, 254, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            flex-direction: column;
            text-align: center;
            background-color: var(--bg-dark);
            color: var(--text-main);
            overflow: hidden;
            position: relative;
        }

        .bg-glow {
            position: fixed;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%);
            top: -100px;
            left: -100px;
            filter: blur(80px);
            z-index: -1;
            opacity: 0.6;
            animation: pulse 10s infinite alternate;
        }

        .bg-glow:nth-child(2) {
            top: auto;
            bottom: -100px;
            left: auto;
            right: -100px;
            background: radial-gradient(circle, rgba(169, 51, 245, 0.3) 0%, transparent 70%);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.2); }
        }

        .loader {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s infinite linear;
            margin-bottom: 30px;
            box-shadow: 0 0 20px rgba(0, 242, 254, 0.2);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .status-container {
            z-index: 10;
            background: rgba(21, 26, 37, 0.8);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 90%;
            max-width: 450px;
            margin: 20px;
        }

        .status-msg {
            color: var(--text-main);
            margin-bottom: 10px;
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .sub-msg {
            color: var(--text-muted);
            margin-bottom: 30px;
            font-size: 1rem;
            line-height: 1.4;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            width: 100%;
            text-align: left;
            display: none;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .info-row:last-child {
            margin-bottom: 0;
        }

        .info-label {
            color: var(--text-muted);
        }

        .info-value {
            color: var(--text-main);
            font-weight: 600;
        }

        .btn {
            display: none;
            width: 100%;
            justify-content: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 700;
            border-radius: 12px;
            text-decoration: none;
            transition: all 0.3s ease;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 242, 254, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-main);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 10px 20px rgba(255, 255, 255, 0.1);
        }

        .success-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            display: none;
        }

        .error-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            display: none;
        }

        @media (max-width: 480px) {
            .bg-glow { opacity: 0.4; }
            .status-container { padding: 30px 20px; }
            .loader { width: 50px; height: 50px; margin-bottom: 25px; }
            .status-msg { font-size: 1.3rem; }
            .sub-msg { font-size: 0.9rem; }
        }
    </style>
</head>
<body>
    <div class="bg-glow"></div>
    <div class="bg-glow"></div>

    <div class="status-container">
        <div class="loader" id="loader"></div>
        <div class="success-icon" id="success-icon">‚úÖ</div>
        <div class="error-icon" id="error-icon">‚ùå</div>
        
        <div class="status-msg" id="status">–û–±—Ä–∞–±–æ—Ç–∫–∞...</div>
        <div class="sub-msg" id="sub-status">–†–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</div>

        <div class="info-card" id="info-card">
            <div class="info-row">
                <span class="info-label">–î–æ–º–µ–Ω:</span>
                <span class="info-value" id="domain-info">‚Äî</span>
            </div>
            <div class="info-row">
                <span class="info-label">User ID:</span>
                <span class="info-value" id="user-info">‚Äî</span>
            </div>
        </div>

        <button class="btn" id="add-btn">
            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
        </button>
        
        <button class="btn btn-secondary" id="copy-btn">
            üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
        </button>
    </div>

    <script>
        (function () {
            let subscriptionUrl = '';
            let domain = '';
            let userId = '';
            let uuid = '';

            try {
                // –ü–æ–ª—É—á–∞–µ–º –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—É—Ç—å –∏–∑ URL (–±–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —á–∞—Å—Ç—å –ø–æ—Å–ª–µ /)
                let rawPath = window.location.pathname.split('/').filter(p => p).pop();

                console.log("Raw path:", rawPath);

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ø—É—Ç—å –Ω–µ –ø—É—Å—Ç–æ–π
                if (!rawPath || rawPath === "index.html") {
                    showError("–°—Å—ã–ª–∫–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–∫–∏");
                    return;
                }

                // –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ URL-safe Base64
                try {
                    // –ó–∞–º–µ–Ω—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ URL-safe —Å–∏–º–≤–æ–ª—ã
                    let safeBase64 = rawPath.replace(/-/g, '+').replace(/_/g, '/');

                    // –î–æ–±–∞–≤–ª—è–µ–º padding
                    while (safeBase64.length % 4 !== 0) {
                        safeBase64 += '=';
                    }

                    // –î–µ–∫–æ–¥–∏—Ä—É–µ–º Base64
                    const decrypted = atob(safeBase64);
                    
                    console.log("Decrypted:", decrypted);

                    // –û–∂–∏–¥–∞–µ–º —Ñ–æ—Ä–º–∞—Ç: add/domain/user_id/uuid
                    const parts = decrypted.split('/');
                    
                    if (parts.length === 4 && parts[0] === 'add') {
                        domain = parts[1];
                        userId = parts[2];
                        uuid = parts[3];

                        // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É
                        subscriptionUrl = `https://${domain}/add/${userId}/${uuid}`;
                        
                        showSuccess();
                    } else {
                        console.error("Invalid parts:", parts);
                        showError("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö");
                    }

                } catch (e) {
                    console.error("Decode error:", e);
                    showError("–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É");
                }

            } catch (err) {
                console.error(err);
                showError("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ");
            }

            function showSuccess() {
                document.getElementById('loader').style.display = 'none';
                document.getElementById('success-icon').style.display = 'block';
                document.getElementById('status').innerText = '–ü–æ–¥–ø–∏—Å–∫–∞ –≥–æ—Ç–æ–≤–∞!';
                document.getElementById('sub-status').innerText = '–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è';

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                const infoCard = document.getElementById('info-card');
                document.getElementById('domain-info').innerText = domain;
                document.getElementById('user-info').innerText = userId;
                infoCard.style.display = 'block';

                const addBtn = document.getElementById('add-btn');
                const copyBtn = document.getElementById('copy-btn');

                addBtn.style.display = 'flex';
                copyBtn.style.display = 'flex';

                // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è - –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤ Happ
                addBtn.onclick = function() {
                    // –§–æ—Ä–º–∏—Ä—É–µ–º deep link –¥–ª—è Happ
                    const happLink = `happ://add/${domain}/${userId}/${uuid}`;
                    
                    console.log("Opening Happ:", happLink);
                    
                    // –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                    window.location.href = happLink;
                    
                    // Fallback: –µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–∫—Ä—ã–ª–æ—Å—å —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        const openDirect = confirm('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Happ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.\n–û—Ç–∫—Ä—ã—Ç—å –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É?');
                        if (openDirect) {
                            window.location.href = subscriptionUrl;
                        }
                    }, 2000);
                };

                // –ö–Ω–æ–ø–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
                copyBtn.onclick = function() {
                    navigator.clipboard.writeText(subscriptionUrl).then(() => {
                        copyBtn.innerHTML = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                        setTimeout(() => {
                            copyBtn.innerHTML = 'üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É';
                        }, 2000);
                    }).catch(() => {
                        // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                        const textarea = document.createElement('textarea');
                        textarea.value = subscriptionUrl;
                        textarea.style.position = 'fixed';
                        textarea.style.opacity = '0';
                        document.body.appendChild(textarea);
                        textarea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textarea);
                        
                        copyBtn.innerHTML = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                        setTimeout(() => {
                            copyBtn.innerHTML = 'üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É';
                        }, 2000);
                    });
                };
            }

            function showError(message) {
                document.getElementById('loader').style.display = 'none';
                document.getElementById('error-icon').style.display = 'block';
                document.getElementById('status').innerText = '–û—à–∏–±–∫–∞';
                document.getElementById('sub-status').innerText = message;
            }
        })();
    </script>
</body>
</html>
